---
title: ICMP
---

## ICMPとは
ICMP(Internet Control Message Protocol)は、IPネットワーク上でホスト間通信を制御するためのプロトコルである。IPパケットの送受信に関するエラーや状況を報告するために使用され、TCPやUDPなどのトランスポート層プロトコルとは異なり、アプリケーション層に直接依存しない。

### 特徴
ICMPメッセージはIPパケットの一部として送られ、IPパケットの中に格納される。  
通常、ICMPメッセージはデータグラムの先頭8バイトに制限されている。  
これ以上の長さを持つ応答を要求するICMPメッセージもあるが、これらは一般的ではない。  
また、ICMPパケットの送信元アドレスは応答を受信するアドレスと同じであり、タイムスタンプ・チェックサムフィールドも設けられている。  
これらの情報を使用して、通信元・宛先のホストが応答を正しく受信できたかどうかを判断できる。  


### 応用例
- エコー要求/エコー応答（ping）機能:  
  ホストAからホストBに対してpingコマンドを実行した際に送られるICMPメッセージ  
  ホストBは受信したICMPメッセージに対して同じ内容のメッセージを返すことで、ホストAに対して「生きている」という情報を伝達する。  

  <img src="https://user-images.githubusercontent.com/56968502/71560393-b0a8c900-2aa9-11ea-8f1f-eacb2a09d6d0.png" width=80%>  

  （図1）エコー要求/エコー応答動作の概観図

  - タイムスタンプ機能:  
    ネットワーク上の疎通確認や遅延時間の測定に使用されます。

    <img src="https://user-images.githubusercontent.com/56968502/71560395-b0a8c900-2aa9-11ea-88ec-dcee4c6e13fc.png" width=50%>

    （図2）タイムスタンプ動作の概観図

    - ネットワークマスク機能:  
      IPアドレスの割り当て方法などネットワーク上の状態を変更する際に使用されます。

      <img src="https://user-images.githubusercontent.com/56968502/71560394-b0123280-2aa9-11ea-8427-3f053c21d49e.png" width=50%>

      （図3）ネットワークマスク動作の概観図

      - ルーティングテーブル機能:  
        デフォルトゲートウェイ設定などルーティングテーブルの管理に使用されます。

        <img src="https://user-images.githubusercontent.com/56968502/71560396-b0a8c900-2aa9-11ea-96a6-12de58dbfa91.png" width=50%>

        （図4）ルーティングテーブル動作の概観図

        - 接続開始・終了機能:  
          TCP接続開始前の準備工程やTCP接続の終了処理などTCP通信の各フェーズで使用されます。

          <img src="https://user-images.githubusercontent.com/56968502/71560397-b1416f80-2aa9-11ea-95df-4dded3eb73fe.png" width=70%>

          （図5）TCP接続開始・終了動作の概観図