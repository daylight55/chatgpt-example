

# STP
## 正称
Spanning Tree Protocol（スパニングツリープロトコル）の略。

## 特徴
LAN内に複数のルートを持つ場合、ルート選択によってはネットワークがループすることがある。STPは、ループを防止するためのプロトコルである。  
STPでは、ポートのステータスを「ブロック」「フォワーディング」「リッカーシング」の3つに分類し、ブロック状態のポートを用いてループを作らないようにしていく。  
また、通信の開始に際してはフォワーディング状態となっており、通信が終了した場合はリッカーシング状態となる。  
これらの動作に加えて、定期的なBPDU（Bridge Protocol Data Unit：ブリッジプロトコルデータユニット）の送受信によってネットワークの状況を監視していく。  
BPDUとは、ブリッジ間で情報をやり取りする際に使用されるデータ形式であり、監視対象は以下の4つである。  

  1. バスID：MACアドレスの上位6ビットから構成される。  
  2. バス番号：バスIDに続く2ビットから構成される。0の場合はセグメント内の機器であり、1以上の場合はバス上の機器である。  
  3. ポート転送モード：セグメント内の機器間の通信方法を示す2ビットフラグであり、00の場合はセグメント内部の通信であり、01の場合はバス上の通信である。  
  4. ポート転送番号：転送モードが00の場合はセグメント内部の通信番号を表す4ビットフラグであり、転送モードが01の場合はバス上の通信番号を表す8ビットフラグである。  

  BPDUの送受信に伴いポート転送モードとポート転送番号が変化すればネットワークの状況も変化しているため監視対象となっている。

  またBPDUに加えてRSTP（Rapid Spanning Tree Protocol）と呼ばれるプロトコルも存在し、RSTPではBPDUの送受信間隔が大幅に短縮されたうえ転送モードと転送番号の監視方法も変更されていくなど改良されてきた。

　　RSTPの改良方法の1つとして特徴的なのが「ポイントツオールドダウン」機能だろう。この機能は以下の流れで動作する。

  1. ネットワーク上から電気的な応答が無くなった際にポイントツオールドダウン機能が動作しフォワーディングポートからブロックポートへ変更することでループ回避を図っていく。

  2. この時間差分が15秒以上かかった場合当該ポイントツオールドダウン機能は無効化されフォワーディングポート転換処理も中断されることになっていく。

  3. また15秒以内に応答が返った場合該当マシーンは生存していることだろうからフォワディングポイント処理も再開され影響の範囲も少なく抑えられていく。

　　この時間差分の実装方法だがOSPFプロトコルの実装方法を利用し実装されていきOSPFプロトコルの完全互換性も備わってきたのだろうか?OSPFプロトコルの完全互換性を備えRSTPプロトコルの完全互換性も備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備う事前条件だったんだろうか?OSPFプロトコルの完全互換性を備・・・